# HAYAKAWA餃子 HP モバイル版スタッキング実装計画書

## ローカルAI向け重要メッセージ

> **⚠️ 実装前に必ず確認してください**
>
> この計画書は現状のコードを基に作成されていますが、実際のファイル（index.html）の内容と差異がある可能性があります。
>
> 1. **実際のファイルを必ず確認**し、この計画書の前提（行番号、既存のCSS構造など）が正しいかチェックしてください
> 2. **目的が達成できるか**を変更前にシミュレーションしてください
> 3. **PC版の挙動に影響が出ないこと**を必ず確認してください
> 4. 不明点や矛盾があれば、実装前にユーザーに確認を取ってください

---

## 1. 現状

### 1.1 PC版の挙動（正常動作中）

~~~yaml
レイアウト:
  - 2カラム構成（左: サイドバー固定 / 右: メインコンテンツ）
  - サイドバーは position: sticky で画面左に固定

スタッキング動作:
  - ヒーロー（#hero）が z-index: 1 で最下層
  - 各 .stack-block が順次上に重なっていく
  - JSで top値 と z-index を動的に設定
  - baseTop: 32px、グループごとに16pxずつオフセット
~~~

### 1.2 モバイル版の現状

~~~yaml
レイアウト:
  - 1カラム構成（縦並び）
  - サイドバーは position: relative で最上部に配置
  - サイドバー内のロゴのみ表示、他は display: none

スタッキング動作:
  - .sticky-card（ヒーロー）に "position: relative !important" が適用されている
  - これによりヒーローのスタッキングが無効化されている
  - .stack-block はスタッキング設定を維持（JSで設定）

ヒーローサイズ:
  - min-height: 50vh（中途半端なサイズ）
~~~

### 1.3 関連するCSS（現状）

~~~css
/* 584〜595行目付近 */
@media (max-width: 900px) {
    /* ... */

    /* hero のみスタッキング解除 ← これが問題 */
    .sticky-card {
        padding: 2rem;
        top: auto !important;
        position: relative !important;  /* ← 削除対象 */
        max-height: none;
        overflow-y: visible;
        margin-top: 0 !important;
        margin-bottom: 1rem !important;
        width: 100%;
        box-sizing: border-box;
    }

    /* ... */

    #hero {
        min-height: 50vh;  /* ← 変更対象 */
    }
}
~~~

---

## 2. やりたいこと

~~~yaml
目的1_モバイルでスタッキング有効化:
  説明: |
    PC版と同じスタッキング挙動をモバイルでも実現する。
    - ロゴが最下層（z-index最小、被ってOK）
    - ヒーローがロゴの上に重なる
    - メニュー、インテリア等が順次重なっていく

目的2_ヒーロー全画面化:
  説明: |
    モバイルでファーストビュー（ロゴ + ヒーロー）が
    画面いっぱい（100vh相当）になるようにする。
~~~

---

## 3. 変更内容

### 3.1 変更箇所一覧

| # | 対象 | 変更内容 | 目的 |
|---|------|----------|------|
| 1 | `.sticky-card`（モバイル版） | `position: relative !important` を削除 | スタッキング有効化 |
| 2 | `.sticky-card`（モバイル版） | `top: auto !important` を削除 | JSのtop設定を有効化 |
| 3 | `#hero`（モバイル版） | `min-height` を計算値に変更 | ファーストビュー全画面化 |

### 3.2 変更後のCSS

~~~css
/* @media (max-width: 900px) 内 */

/* 変更後: .sticky-card */
.sticky-card {
    padding: 2rem;
    /* top: auto !important;  ← 削除 */
    /* position: relative !important;  ← 削除 */
    max-height: none;
    overflow-y: visible;
    margin-top: 0 !important;
    margin-bottom: 1rem !important;
    width: 100%;
    box-sizing: border-box;
}

/* 変更後: #hero */
#hero {
    min-height: calc(100dvh - 70px);
    /* 70px = ロゴ部分の高さ（padding: 1rem × 2 + ロゴ自体の高さ） */
    /* 実機で確認し、必要に応じて調整 */
}
~~~

### 3.3 ロゴ高さの算出根拠

~~~yaml
サイドバー（モバイル版）:
  padding: 1rem（上下で約32px）
  padding-bottom: 0 に上書きされている
  → 上paddingのみ: 約16px

ロゴ画像:
  max-width: 100%
  実際の高さ: 推定40〜50px程度

合計推定: 約60〜70px

注意: |
  この値は推定値です。
  実機で確認し、ロゴとヒーローの境界が
  ファーストビュー下端に来るよう調整してください。
~~~

---

## 4. 変更しない箇所（PC版保護）

~~~yaml
確認事項:
  - 変更は全て @media (max-width: 900px) 内に限定
  - PC版（900px以上）のCSSには一切触れない
  - JSのスタッキングロジックは変更しない（PC/モバイル共通で動作）

PC版で影響が出ないことの確認方法:
  1. 900px以上の幅でページを開く
  2. スクロールしてスタッキングが正常に動作することを確認
  3. サイドバーが固定表示されていることを確認
~~~

---

## 5. 実装手順

~~~yaml
手順1:
  作業: "@media (max-width: 900px)" 内の .sticky-card を探す
  確認: position: relative !important と top: auto !important があるか

手順2:
  作業: 上記2行を削除（またはコメントアウト）
  注意: 他のプロパティ（padding, width等）は残す

手順3:
  作業: 同メディアクエリ内の #hero を探す
  確認: min-height: 50vh があるか

手順4:
  作業: min-height を calc(100dvh - 70px) に変更
  注意: 70pxは調整が必要な可能性あり

手順5:
  作業: 動作確認
  確認項目:
    - モバイル幅でスタッキングが動作するか
    - ファーストビューがほぼ全画面になるか
    - PC幅で従来通り動作するか
~~~

---

## 6. 想定される問題と対処

~~~yaml
問題1:
  症状: モバイルでスタッキングが効かない
  原因: CSSの優先度で !important が残っている可能性
  対処: 該当行が確実に削除されているか再確認

問題2:
  症状: ヒーローとロゴの間に隙間または重なりすぎ
  原因: ロゴ高さの推定値（70px）が実際と異なる
  対処: 実機で確認し、calc()内の値を調整

問題3:
  症状: PC版のレイアウトが崩れた
  原因: メディアクエリ外のCSSを誤って変更した
  対処: 変更を元に戻し、@media内のみ修正されているか確認

問題4:
  症状: スタッキングの開始位置がおかしい（ロゴに被りすぎ/離れすぎ）
  原因: JSのbaseTop値がモバイルに最適化されていない
  対処: 必要ならJSでモバイル判定を追加（ただし今回のスコープ外）
~~~

---

## 7. 補足：100dvh について

~~~yaml
説明: |
  dvh = Dynamic Viewport Height
  モバイルブラウザのアドレスバー表示/非表示を考慮した単位。
  100vh だとアドレスバー分はみ出すことがあるが、
  100dvh は動的に調整される。

フォールバック:
  古いブラウザ対応が必要な場合は以下のように書く:
  
  #hero {
      min-height: 100vh;  /* フォールバック */
      min-height: calc(100dvh - 70px);  /* モダンブラウザ */
  }
~~~

---

## 8. チェックリスト

実装完了後、以下を確認してください：

- [ ] モバイル幅（900px以下）でスタッキングが動作する
- [ ] ロゴ → ヒーロー → メニュー → ... の順で重なる
- [ ] ファーストビュー（ロゴ + ヒーロー）がほぼ全画面
- [ ] PC幅（900px以上）で従来通り動作する
- [ ] PC版のサイドバーが固定表示されている
- [ ] PC版のスタッキングに変化がない
