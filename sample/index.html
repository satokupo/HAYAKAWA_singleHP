<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="index, follow">
    
    <title>HAYAKAWA|一口餃子専門店</title>
    <meta name="description" content="{{PAGE_DESCRIPTION}}">
    
    <!-- OGP / Twitter Card -->
    <meta property="og:title" content="{{PAGE_TITLE}}">
    <meta property="og:description" content="{{PAGE_DESCRIPTION}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{PAGE_URL}}">
    <meta property="og:image" content="{{OGP_IMAGE_URL}}">
    <meta property="og:site_name" content="{{SITE_NAME}}">
    <meta property="og:locale" content="ja_JP">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{PAGE_TITLE}}">
    <meta name="twitter:description" content="{{PAGE_DESCRIPTION}}">
    <meta name="twitter:image" content="{{OGP_IMAGE_URL}}">
    
    <!-- プロジェクトメモ（Astro移行時に削除） -->
    <script>
        /*
         * PROJECT RULES - {{PROJECT_NAME}}
         *
         * [カラー] ※実装値は :root のCSS変数を参照
         * - primary: ブランドカラー、見出し・ロゴに使用
         * - accent: アクセントカラー
         * - text: 本文
         * - text-sub: 補足テキスト、説明文
         * - bg-main: 背景色
         * - bg-section: セクション背景色
         *
         * [トンマナ]
         * - キーワード: {{TONE_KEYWORDS}}
         * - 避けるもの: {{AVOID_KEYWORDS}}
         *
         * [フォント] Noto Sans JP (400/500/700)
         *
         * [ターゲット]
         * - ペルソナ: {{PERSONA_SUMMARY}}
         * - 課題: {{TARGET_PAIN_POINTS}}
         *
         * [メニューカルーセル]
         * - バニラJS実装（無限ループ対応）
         * - スライドを複数セット複製し、端に近づいたら瞬時に中央へリセット
         *
         * ※ AI向けメモ：記載内容は必要に応じて調整
         */
    </script>

    <!-- Favicon -->
    <link rel="icon" href="image/favicon/favicon.ico" sizes="any">
    <link rel="icon" href="image/favicon/icon-192.png" type="image/png" sizes="192x192">
    <link rel="apple-touch-icon" href="image/favicon/apple-touch-icon.png">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Zen+Kurenaido&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            corePlugins: {
                preflight: false,
            }
        }
    </script>

    <style>
        :root {
            --color-primary: #333333;
            --color-accent: #3b82f6;
            --color-text: #333333;
            --color-text-sub: #666666;
            --color-text-light: #d9c8a6;
            --bg-main: #ffffff;
            --bg-section: #f5f5f5;
            --bg-dark: #1a1a1a;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-main);
            color: var(--color-text);
            overflow-x: hidden;
            max-width: 390px;
            margin: 0 auto;
        }

        img { vertical-align: bottom; }

        /* ヒーローセクション */
        .hero {
            position: relative;
            height: min(100svh, 900px);
            background-image: url('images/hero-main.webp');
            background-size: cover;
            background-position: right top;
            background-repeat: no-repeat;
            background-color: var(--bg-section);
        }

        .hero__content {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }

        .hero__title {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--color-primary);
        }

        .hero__subtitle {
            font-size: 0.875rem;
            color: var(--color-text-sub);
            margin-top: 0.25rem;
        }

        .hero__catch {
            font-family: 'Zen Kurenaido', cursive;
            font-size: 1.25rem;
            writing-mode: vertical-rl;
            color: var(--color-primary);
            position: absolute;
            left: 1.5rem;
            bottom: 3rem;
        }

        /* スクロールアニメーション */
        @keyframes slideInLeft {
            0% {
                opacity: 0;
                transform: translate(-80px, 120px) rotate(-5deg);
            }
            60% {
                opacity: 0.8;
                transform: translate(-20px, 30px) rotate(-2deg);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
            }
        }

        @keyframes slideInRight {
            0% {
                opacity: 0;
                transform: translate(80px, 120px) rotate(5deg);
            }
            60% {
                opacity: 0.8;
                transform: translate(20px, 30px) rotate(2deg);
            }
            100% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
            }
        }

        .animate-left {
            opacity: 0;
        }

        .animate-right {
            opacity: 0;
        }

        .animate-left.visible {
            animation: slideInLeft 0.4s ease-out forwards;
        }

        .animate-right.visible {
            animation: slideInRight 0.4s ease-out forwards;
        }

        /* 今月の餃子セクション */
        .limited {
            position: relative;
            height: min(100svh, 900px);
            background-image: url('images/limited-bg.webp');
            background-size: cover;
            background-position: center;
            padding: 0 1rem;
        }

        .limited__content {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .limited__title {
            font-size: 1.25rem;
            color: #fff;
            margin-bottom: 1.5rem;
        }

        .limited__image-wrapper {
            position: relative;
            width: 260px;
            height: 260px;
        }

        .limited__image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .limited__decoration {
            position: absolute;
            top: -12px;
            left: -12px;
            width: calc(100% + 24px);
            height: calc(100% + 24px);
        }

        .limited__name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-top: 1.5rem;
            color: #fff;
        }

        .limited__description {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.85);
            margin-top: 0.5rem;
            line-height: 1.6;
        }

        /* メニューセクション */
        .menu {
            padding: 3rem 1rem;
            text-align: center;
        }

        .menu__title {
            font-size: 1.25rem;
            letter-spacing: 0.2em;
            color: var(--color-primary);
            margin-bottom: 2rem;
        }

        .menu__main {
            margin-bottom: 2rem;
        }

        .menu__main-image {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            display: block;
        }

        .menu__name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 0.25rem;
        }

        .menu__price {
            font-size: 1rem;
            color: var(--color-text-sub);
            margin-bottom: 0.5rem;
        }

        .menu__description {
            font-size: 0.875rem;
            color: var(--color-text-sub);
            line-height: 1.6;
        }

        /* メニューカルーセル（バニラJS・遅延読み込み対応） */
        .menu__carousel {
            padding: 1rem 0;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            overscroll-behavior-x: contain;  /* ページスクロール防止・バウンス効果 */
        }

        .menu__carousel::-webkit-scrollbar {
            display: none;
        }

        .menu__carousel-track {
            position: relative;
            display: flex;
            gap: 16px;
            padding-left: calc(50% - 40px);
        }

        /* 右端スペーサー（JSで追加） */
        .menu__carousel-spacer {
            flex-shrink: 0;
        }

        .menu__slide {
            flex-shrink: 0;
            width: 80px;
            height: 80px;
        }

        .menu__thumb {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            opacity: 0.6;
        }

        .menu__slide.is-active .menu__thumb {
            transform: scale(1.1);
            opacity: 1;
        }

        /* 店舗情報セクション */
        .shop {
            background-color: var(--bg-dark);
            background-image: url('images/bg-dark-noise.webp');
            background-repeat: repeat;
            padding: 3rem 1.5rem;
            padding-bottom: 5rem;
        }

        .shop__content {
            text-align: center;
        }

        .shop__logo {
            font-size: 1.75rem;
            font-weight: 400;
            letter-spacing: 0.15em;
            color: var(--color-text-light);
            margin-bottom: 1rem;
        }

        .shop__hours {
            font-size: 0.875rem;
            color: var(--color-text-light);
            margin-bottom: 1rem;
        }

        .shop__hours-btn {
            display: inline-block;
            background-color: var(--color-text-light);
            color: var(--bg-dark);
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.625rem 1.5rem;
            border-radius: 0.375rem;
            text-decoration: none;
            margin-bottom: 1.5rem;
            transition: opacity 0.2s;
        }

        .shop__hours-btn:hover,
        .shop__hours-btn:focus {
            opacity: 0.85;
        }

        .shop__calendar {
            margin-bottom: 1rem;
        }

        .shop__calendar-image {
            max-width: 280px;
            width: 100%;
            height: auto;
        }

        .shop__days {
            font-size: 1rem;
            font-weight: 500;
            color: var(--color-text-light);
            letter-spacing: 0.5em;
            margin-bottom: 1.5rem;
        }

        .shop__address {
            font-style: normal;
            color: var(--color-text-light);
            margin-bottom: 1.5rem;
        }

        .shop__address-text {
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .shop__phone {
            font-size: 1rem;
        }

        .shop__phone a {
            color: var(--color-text-light);
            text-decoration: none;
        }

        .shop__actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .shop__btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 120px;
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 0.375rem;
            text-decoration: none;
            transition: background-color 0.2s, color 0.2s;
        }

        .shop__btn--outline {
            background-color: transparent;
            color: var(--color-text-light);
            border: 1px solid var(--color-text-light);
        }

        .shop__btn--outline:hover,
        .shop__btn--outline:focus {
            background-color: var(--color-text-light);
            color: var(--bg-dark);
        }

        .shop__social {
            margin-top: 1.5rem;
        }

        .shop__social-link {
            display: inline-flex;
            color: var(--color-text-light);
            transition: opacity 0.2s;
        }

        .shop__social-link:hover,
        .shop__social-link:focus {
            opacity: 0.7;
        }

        /* フッター */
        .footer {
            background-color: var(--bg-dark);
            background-image: url('images/bg-dark-noise.webp');
            background-repeat: repeat;
            padding: 1rem 1.5rem;
            padding-bottom: calc(1rem + 70px);
            text-align: center;
        }

        .footer__copyright {
            font-size: 0.75rem;
            color: var(--color-text-light);
        }

        /* 固定ナビゲーション */
        .fixed-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 390px;
            background-color: var(--bg-main);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem 0;
            box-shadow: none;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .fixed-nav.is-visible {
            opacity: 1;
            visibility: visible;
        }

        .fixed-nav__item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            color: var(--color-text);
            text-decoration: none;
            min-width: 60px;
            min-height: 44px;
            transition: color 0.2s;
        }

        .fixed-nav__item:hover,
        .fixed-nav__item:focus {
            color: var(--color-accent);
        }

        .fixed-nav__icon {
            width: 24px;
            height: 24px;
            margin-bottom: 0.25rem;
            object-fit: contain;
        }

        .fixed-nav__label {
            font-size: 0.625rem;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header id="header">
        <!-- TODO: ヘッダー実装 -->
    </header>

    <main>
        <!-- SECTION 01: ヒーローセクション -->
        <section id="section-01" class="hero">
            <!-- テキストコンテンツ（背景画像はCSSで設定） -->
            <div class="hero__content">
                <h1 class="hero__title">HAYAKAWA</h1>
                <p class="hero__subtitle">一口餃子専門店</p>
                <p class="hero__catch">カフェみたいな、餃子屋。</p>
            </div>
        </section>


        <!-- SECTION 02: インテリア -->
        <section id="section-02" class="py-12 px-4 mt-8">
            <!-- 1枚目: 左寄せ、逆傾き -->
            <div class="mr-12 mb-8 animate-left">
                <img src="images/interior-1.webp" alt="店内の様子"
                     class="max-w-full max-h-56 rounded-2xl -rotate-2"
                     width="600" height="400" loading="lazy">
            </div>

            <!-- 2枚目: 右寄せ -->
            <div class="ml-12 mb-8 animate-right">
                <img src="images/interior-2.webp" alt="インテリア"
                     class="max-w-full max-h-56 rounded-2xl"
                     width="600" height="400" loading="lazy">
            </div>

            <!-- 3枚目: 左寄せ、傾き -->
            <div class="mr-12 mb-8 animate-left">
                <img src="images/interior-3.webp" alt="テーブルセッティング"
                     class="max-w-full max-h-56 rounded-2xl rotate-2"
                     width="600" height="400" loading="lazy">
            </div>
        </section>

        <!-- SECTION 03: 今月の餃子 -->
        <section id="section-03" class="limited">
            <div class="limited__content">
                <h2 class="limited__title">今月の餃子</h2>

                <div class="limited__image-wrapper">
                    <!-- 装飾ライン（SVG） -->
                    <svg class="limited__decoration" viewBox="0 0 220 220">
                        <circle cx="110" cy="110" r="105"
                                fill="none"
                                stroke="white"
                                stroke-width="2"
                                stroke-dasharray="8 6"/>
                    </svg>
                    <img src="images/limited-gyoza.webp"
                         alt="今月の餃子"
                         class="limited__image"
                         width="300" height="300" loading="lazy">
                </div>

                <p class="limited__name">栗と鶏肉の甘辛餃子</p>
                <p class="limited__description">
                    ほっくり甘い栗と、ジューシーな鶏肉を<br>
                    甘辛く仕上げました。
                </p>
            </div>
        </section>

        <!-- SECTION 04: メニュー -->
        <section id="section-04" class="menu">
            <h2 class="menu__title">MENU</h2>

            <!-- メイン表示エリア -->
            <div class="menu__main">
                <img id="menu-main-image" class="menu__main-image" src="" alt="" width="200" height="200" loading="lazy">
                <p id="menu-name" class="menu__name"></p>
                <p id="menu-price" class="menu__price"></p>
                <p id="menu-description" class="menu__description"></p>
            </div>

            <!-- サムネイルカルーセル（無限ループ） -->
            <div class="menu__carousel">
                <div class="menu__carousel-track">
                    <!-- JSで生成 -->
                </div>
            </div>
        </section>

        <!-- SECTION 05: 店舗情報 -->
        <section id="section-05" class="shop">
            <div class="shop__content">
                <h2 class="shop__logo">HAYAKAWA</h2>

                <p class="shop__hours">11:00 - 16:00（L.o.15:45）</p>

                <a href="https://www.google.com"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="shop__hours-btn">
                    営業時間を確認する
                </a>

                <div class="shop__calendar">
                    <img src="images/calendar.webp"
                         alt="営業カレンダー"
                         class="shop__calendar-image"
                         width="280" height="200" loading="lazy">
                </div>

                <p class="shop__days">月・水・金・土</p>

                <address class="shop__address">
                    <p class="shop__address-text">長野県飯田市仲ノ町353-10</p>
                    <p class="shop__phone">
                        <a href="tel:050-8885-3753">050-8885-3753</a>
                    </p>
                </address>

                <div class="shop__actions">
                    <a href="https://www.google.com"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="shop__btn shop__btn--outline">
                        予約する
                    </a>
                    <a href="https://www.google.com"
                       target="_blank"
                       rel="noopener noreferrer"
                       class="shop__btn shop__btn--outline">
                        地図を見る
                    </a>
                </div>

                <div class="shop__social">
                    <a href="https://www.instagram.com"
                       target="_blank"
                       rel="noopener noreferrer"
                       aria-label="Instagram"
                       class="shop__social-link">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="2" y="2" width="20" height="20" rx="5" ry="5"/>
                            <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/>
                            <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/>
                        </svg>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- 固定ナビゲーション -->
    <nav class="fixed-nav" aria-label="メインナビゲーション">
        <a href="#section-04" class="fixed-nav__item">
            <img src="images/nav-gyoza.png" alt="" class="fixed-nav__icon" width="24" height="24">
            <span class="fixed-nav__label">餃子</span>
        </a>
        <a href="https://www.google.com" target="_blank" rel="noopener noreferrer" class="fixed-nav__item">
            <img src="images/nav-reserve.png" alt="" class="fixed-nav__icon" width="24" height="24">
            <span class="fixed-nav__label">予約</span>
        </a>
        <a href="#section-05" class="fixed-nav__item">
            <img src="images/nav-shop.png" alt="" class="fixed-nav__icon" width="24" height="24">
            <span class="fixed-nav__label">店舗情報</span>
        </a>
        <a href="https://www.google.com" target="_blank" rel="noopener noreferrer" class="fixed-nav__item">
            <img src="images/nav-map.png" alt="" class="fixed-nav__icon" width="24" height="24">
            <span class="fixed-nav__label">地図</span>
        </a>
    </nav>

    <!-- FOOTER -->
    <footer class="footer">
        <p class="footer__copyright">&copy; <span id="year"></span> HAYAKAWA</p>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // スクロールアニメーション
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, {
            rootMargin: '-30% 0px -30% 0px'
        });

        document.querySelectorAll('.animate-left, .animate-right').forEach(el => {
            observer.observe(el);
        });

        /**
         * メニューカルーセル
         *
         * 商品データ配列
         * 記載方法:
         * - name: 商品名（必須）
         * - price: 価格表示（必須）
         * - description: 説明文（必須、改行が必要な場合は<br>タグを使用）
         *   例: '一行目の説明文<br>二行目の説明文'
         * - image: 画像パス（必須）
         *
         * 商品を追加する場合は配列に新しいオブジェクトを追加するだけでOK
         */
        const menuItems = [
            { name: '商品１', price: '¥400〜', description: '薄皮でパリッと、一口サイズ', image: 'images/menu-1.webp' },
            { name: '商品２', price: '¥600〜', description: '香ばしく炒めた自家製チャーハン', image: 'images/menu-2.webp' },
            { name: '商品３', price: '¥700〜', description: 'あっさり醤油の中華そば', image: 'images/menu-3.webp' }
        ];
    </script>

    <!-- メニューカルーセル（バニラJS・遅延読み込み対応） -->
    <script>
        (function initMenuCarousel() {
            const carousel = document.querySelector('.menu__carousel');
            const track = document.querySelector('.menu__carousel-track');
            const mainImage = document.getElementById('menu-main-image');
            const nameEl = document.getElementById('menu-name');
            const priceEl = document.getElementById('menu-price');
            const descEl = document.getElementById('menu-description');

            if (!track || menuItems.length === 0) return;

            // 設定
            const INITIAL_SETS = 3;  // 初期セット数
            const MAX_SETS = 10;     // 最大セット数
            const ITEM_WIDTH = 80;
            const LOAD_THRESHOLD = ITEM_WIDTH * 4;  // 読み込み開始の閾値（320px）

            let currentSets = 0;
            let currentIndex = 0;
            let isScrolling = false;
            let isLoading = false;  // 追加読み込み中フラグ
            let slides = [];

            // スライド1つを生成
            function createSlide(item, realIndex, slideIndex) {
                const slide = document.createElement('div');
                slide.className = 'menu__slide';
                slide.dataset.realIndex = realIndex;
                slide.dataset.slideIndex = slideIndex;

                const img = document.createElement('img');
                img.src = item.image;
                img.alt = item.name;
                img.className = 'menu__thumb';
                img.loading = 'lazy';

                slide.appendChild(img);

                // クリックイベントを設定
                slide.addEventListener('click', () => {
                    const ri = parseInt(slide.dataset.realIndex);
                    const si = parseInt(slide.dataset.slideIndex);
                    currentIndex = ri;
                    updateActiveState(ri);
                    updateMainDisplay(ri);
                    scrollToSlideByElement(slide);
                });

                return slide;
            }

            // 右端スペーサーを作成
            const spacer = document.createElement('div');
            spacer.className = 'menu__carousel-spacer';
            spacer.style.width = (carousel.clientWidth / 2 - ITEM_WIDTH / 2) + 'px';
            track.appendChild(spacer);

            // セットを追加（スペーサーの前に挿入）
            function appendSets(count) {
                for (let s = 0; s < count && currentSets < MAX_SETS; s++) {
                    menuItems.forEach((item, i) => {
                        const slideIndex = currentSets * menuItems.length + i;
                        const slide = createSlide(item, i, slideIndex);
                        track.insertBefore(slide, spacer);
                    });
                    currentSets++;
                }
                // slides配列を更新
                slides = Array.from(track.querySelectorAll('.menu__slide'));
            }

            // 初期セットを生成
            appendSets(INITIAL_SETS);

            // メイン表示を更新
            function updateMainDisplay(index) {
                const item = menuItems[index];
                mainImage.src = item.image;
                mainImage.alt = item.name;
                nameEl.textContent = item.name;
                priceEl.textContent = item.price;
                descEl.innerHTML = item.description;
            }

            // アクティブ状態を更新
            function updateActiveState(realIndex) {
                slides.forEach(slide => {
                    const isActive = parseInt(slide.dataset.realIndex) === realIndex;
                    slide.classList.toggle('is-active', isActive);
                });
            }

            // 要素を中央にスクロール
            function scrollToSlideByElement(targetSlide, smooth = true) {
                if (!targetSlide) return;

                isScrolling = true;

                const slideCenter = targetSlide.offsetLeft + ITEM_WIDTH / 2;
                const scrollTarget = slideCenter - carousel.clientWidth / 2;

                carousel.scrollTo({
                    left: scrollTarget,
                    behavior: smooth ? 'smooth' : 'instant'
                });

                setTimeout(() => {
                    isScrolling = false;
                }, smooth ? 400 : 50);
            }

            // インデックスでスクロール
            function scrollToSlide(slideIndex, smooth = true) {
                const targetSlide = slides[slideIndex];
                if (targetSlide) {
                    scrollToSlideByElement(targetSlide, smooth);
                }
            }

            // 右端に近づいたら追加読み込み
            function checkAndLoadMore() {
                if (isLoading || currentSets >= MAX_SETS) return;

                const maxScroll = carousel.scrollWidth - carousel.clientWidth;

                if (carousel.scrollLeft > maxScroll - LOAD_THRESHOLD) {
                    isLoading = true;
                    appendSets(2);
                    updateActiveState(currentIndex);
                    setTimeout(() => { isLoading = false; }, 100);
                }
            }

            // スクロール時の処理
            let scrollTimeout = null;
            carousel.addEventListener('scroll', () => {
                // 追加読み込みチェック
                checkAndLoadMore();

                // プログラムによるスクロール中は以下をスキップ
                if (isScrolling) return;

                if (scrollTimeout) clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    // スクロール位置から中央のスライドを特定
                    const scrollCenter = carousel.scrollLeft + carousel.clientWidth / 2;
                    let closestIndex = 0;
                    let closestDistance = Infinity;

                    slides.forEach((slide, i) => {
                        const slideCenter = slide.offsetLeft + ITEM_WIDTH / 2;
                        const distance = Math.abs(scrollCenter - slideCenter);
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestIndex = i;
                        }
                    });

                    const realIndex = parseInt(slides[closestIndex].dataset.realIndex);
                    if (realIndex !== currentIndex) {
                        currentIndex = realIndex;
                        updateActiveState(realIndex);
                        updateMainDisplay(realIndex);
                    }
                }, 100);
            }, { passive: true });

            // スクロール終了時にも追加読み込みをチェック
            carousel.addEventListener('scrollend', () => {
                checkAndLoadMore();
            }, { passive: true });

            // 初期化：セット2の最初のアイテムを中央に
            const initialSlideIndex = menuItems.length;  // セット2の開始位置
            updateActiveState(0);
            updateMainDisplay(0);
            setTimeout(() => {
                scrollToSlide(initialSlideIndex, false);
            }, 50);
        })();
    </script>

    <!-- 固定ナビ表示制御 -->
    <script>
        (function initFixedNav() {
            const fixedNav = document.querySelector('.fixed-nav');
            const hero = document.getElementById('section-01');

            if (!fixedNav || !hero) return;

            const navHeight = 70;

            function updateNavVisibility() {
                const heroRect = hero.getBoundingClientRect();
                // Heroの下端がナビの高さ分より上にあれば、ナビを表示
                if (heroRect.bottom < window.innerHeight - navHeight) {
                    fixedNav.classList.add('is-visible');
                } else {
                    fixedNav.classList.remove('is-visible');
                }
            }

            window.addEventListener('scroll', updateNavVisibility, { passive: true });
            updateNavVisibility(); // 初期状態をチェック
        })();
    </script>
</body>
</html>
